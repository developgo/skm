workspace:
  base: /go
  path: src/github.com/developgo/skm
  
pipeline:
  test:
    image: golang:latest
    commands:
      - go vet
      - go test -v -cover
  build:
    image: golang:latest
    commands:
      - go build -ldflags "-X main.Version=${DRONE_TAG}" -o dea
      - go test -v
  release:
    image: golang:latest
    secrets: [github_token]
    commands:
      curl -sL https://git.io/goreleaser | bash
    when:
      event: tag
